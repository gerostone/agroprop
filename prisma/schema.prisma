generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  AGENT
  ADMIN
}

enum ListingStatus {
  DRAFT
  PUBLISHED
  PAUSED
  ARCHIVED
}

enum ListingType {
  AGRICOLA
  GANADERO
  MIXTO
  ARROCERO
  FORESTAL
}

enum ListingModality {
  VENTA
  ALQUILER
}

enum WaterSource {
  TAJAMAR
  ARROYO
  RIO
  POZO
  NINGUNO
}

enum SlopeRange {
  P0_2
  P2_5
  P5_10
  P10_PLUS
}

model User {
  id           String     @id @default(uuid())
  name         String?
  email        String     @unique
  passwordHash String?
  role         Role       @default(USER)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  listings     Listing[]
  favorites    Favorite[]
}

model Listing {
  id           String         @id @default(uuid())
  ownerId      String
  owner        User           @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  title        String?
  slug         String?        @unique
  locationText String?
  department   String?
  district     String?
  hectaresTotal Float?
  type         ListingType?
  modality     ListingModality?
  description  String?
  phoneWhatsapp String?
  contactEmail  String?
  salePriceTotalUsd    Float?
  salePriceUsdPerHa    Float?
  rentUsdPerHaPerYear  Float?
  rentCropSharePercent Float?
  lat          Float?
  lng          Float?
  productiveAptitude String?
  currentUse         String?
  rotationsHistory   String?
  soilType           String?
  productivityIndex  Float?
  waterSources       WaterSource[] @default([])
  hasElectricity     Boolean?
  hasInternalRoads   Boolean?
  hasFences          Boolean?
  hasCorrals         Boolean?
  hasSilos           Boolean?
  hasSheds           Boolean?
  distanceToPavedRouteKm Float?
  distanceToTownKm       Float?
  yearRoundAccess        Boolean?
  maxSlopePercentRange   SlopeRange?
  completenessScore Int           @default(0)
  status       ListingStatus  @default(DRAFT)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  images       ListingImage[]
  leads        Lead[]
  favorites    Favorite[]

  @@index([status, createdAt])
  @@index([department, district])
  @@index([type])
  @@index([modality])
  @@index([hectaresTotal])
  @@index([completenessScore])
}

model ListingImage {
  id        String   @id @default(uuid())
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  url       String
  sortOrder Int      @default(0)
}

model Lead {
  id          String   @id @default(uuid())
  listingId   String
  listing     Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  senderName  String
  senderEmail String
  senderPhone String
  message     String
  createdAt   DateTime @default(now())
}

model Favorite {
  userId    String
  listingId String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@id([userId, listingId])
  @@index([listingId])
}
